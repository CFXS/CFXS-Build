-- set_linker("arm-none-eabi-ld")
-- set_c_compiler("arm-none-eabi-gcc", "11")
-- set_cpp_compiler("arm-none-eabi-g++", "20")
-- set_asm_compiler("arm-none-eabi-gcc")

set_c_compiler("iccarm", "11")
set_cpp_compiler("iccarm", "14")
set_asm_compiler("iasmarm")
set_linker("ilinkarm")

local test_project = create_executable("CFXS-Build-Test")
test_project:set_linker_script("./LinkerScript.ld")

function actually_import_modules()
    import("./modules/Module_A")
end

function import_modules()
    actually_import_modules()
end

import_modules()

-- import("/mnt/d/cfxs_ext_module")

local sources = {
    "./src/**.c", -- current dir + recursive search
    "./src/main.cpp", -- single file
    "!makefsdata.c" -- full path matching exclude (path.contains(exclude_entry))
}

test_project:add_sources(sources)
test_project:add_include_paths("private", {"./src"})
-- test_project:add_definitions("forward", {
--     "BUILD_SOMETHING",
--     '__na_force_inline_speed=_Pragma("inline=forced") constexpr'
-- })
-- test_project:add_compile_options("forward", {"-O3"})

import_git("https://github.com/CFXS/CFXS-Framework-v2-Dev.git", "main");
import("./Cortex_M4F.cfxs-build")

test_project:add_libraries({
    cfxs_framework,
})
